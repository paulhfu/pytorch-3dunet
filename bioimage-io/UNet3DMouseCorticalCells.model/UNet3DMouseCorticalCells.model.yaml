name: 3D UNet Mouse Brain Histone-GFP Nuclei
description: A 3d U-Net trained to predict nuclei and inner nuclei boundaries of in-vivo 2 photon z-stacks of Histone-GFP labelled cell nuclei in mouse brains.
cite:
  - text: "Livia  Asan et al. Grey matter volume changes and corresponding cellular metrics identified in a longitudinal in vivo imaging approach. BioRxiv preprint."
    doi: https://doi.org/10.1101/559765
authors:
  - Livia Asan; Claudia Falfan-Melgoza; Wolfgang Weber-Fahr; Carlo Beretta; Thomas Kuner; Johannes Knabbe
documentation: ../../README.md
tags: [unet3d, pytorch, cell nuclei, segmentation, nuclei boundary]
license: MIT

format_version: 0.1.0
language: python
framework: pytorch

source: pytorch3dunet.unet3d.model.UNet3D
optional_kwargs:
  name: UNet3D
  # number of input channels to the model
  in_channels: 1
  # number of output channels: segmentation mask, 'thick' boundaries, 'inner' boundaries, 'outer' boundaries
  out_channels: 2
  # determines the order of operators in a single layer (crg - Conv3d+ReLU+GroupNorm)
  layer_order: gcr
  # initial number of feature maps
  f_maps: [32, 64, 128]
  # number of groups in the groupnorm
  num_groups: 8
  # apply element-wise nn.Sigmoid after the final 1x1x1 convolution, otherwise apply nn.Softmax
  final_sigmoid: true
  is_segmentation: true

covers: [raw_pred_example.png]

inputs:
  - name: raw
    axes: bczyx
    data_type: float32
    data_range: [-inf, inf]
    shape: [1, 1, 20, 180, 180]

outputs:
  - name: predictions
    axes: bczyx
    data_type: float32
    data_range: [0, 1]
    halo: [0, 0, 8, 16, 16]
    shape:
        reference_input: raw
        scale: [1, 1, 1, 1, 1]
        offset: [0, 0, 0, 0, 0]

prediction:
  preprocess:
    - spec: https://github.com/bioimage-io/pytorch-bioimage-io/blob/f71b8ac598267de88cd39e5495abd93dcda1d0a4/specs/transformations/EnsureTorch.transformation.yaml
    - spec: https://github.com/bioimage-io/pytorch-bioimage-io/blob/f71b8ac598267de88cd39e5495abd93dcda1d0a4/specs/transformations/Cast.transformation.yaml
      kwargs: {dtype: float32}
    - spec: https://github.com/bioimage-io/pytorch-bioimage-io/blob/f71b8ac598267de88cd39e5495abd93dcda1d0a4/specs/transformations/NormalizeZeroMeanUnitVariance.transformation.yaml
      kwargs: {apply_to: [0]}
  weights:
    source: best_model_state_dict.pth
    hash: {md5: b843d46937a512ade5b5a2ec0678a59a}
  postprocess:
    - spec: https://github.com/bioimage-io/pytorch-bioimage-io/blob/f71b8ac598267de88cd39e5495abd93dcda1d0a4/specs/transformations/Sigmoid.transformation.yaml
    - spec: https://github.com/bioimage-io/pytorch-bioimage-io/blob/f71b8ac598267de88cd39e5495abd93dcda1d0a4/specs/transformations/EnsureNumpy.transformation.yaml

  dependencies: conda:environment.yaml
